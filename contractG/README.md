# 合同生成工具 (contractG)

一个用于生成和管理销售合同的桌面应用程序，使用Python和PyQt5开发。

## 功能特点

### 1. 客户管理
- 添加、编辑、删除客户信息
- 客户信息包含：公司名称、联系人、电话、地址、开户行、银行账号、税号等
- 支持客户信息搜索和筛选

### 2. 商品管理
- 添加、编辑、删除商品信息
- 商品信息包含：商品名称、规格型号、单位、单价等
- 支持商品信息搜索和筛选

### 3. 合同生成
- 支持选择客户和商品生成合同
- 自动计算合同金额（商品总额 + 技术服务费）
- 支持设置合同编号、签订日期、交货日期
- 支持自定义付款方式
- 支持设置报价单有效期
- 自动生成合同和报价单文件
- 支持将Excel文件转换为PDF格式
- 支持在PDF文件上添加公司印章
- 支持将PDF转换为图片式PDF，提高文件兼容性

### 4. Excel转PDF工具
- 支持将Excel文件直接拖放转换为PDF
- 支持选择是否转换为图片式PDF，提高兼容性
- 直观的转换进度和状态显示
- 转换完成后可直接打开PDF文件
- 简洁美观的用户界面，操作简单直观

### 5. 乙方公司管理
- 支持管理多个乙方公司信息
- 可以设置默认乙方公司
- 支持从文本解析导入公司信息（如开票信息）
- 公司信息包含：公司名称、联系人、电话、地址、开户行、银行账号、税号等
- 支持公司信息的添加、编辑、删除操作
- 支持公司印章上传

### 6. 系统功能
- 支持打开数据目录和输出目录
- 首次运行自动引导配置公司信息
- 支持系统设置管理
- 提供帮助和关于信息

## UI设计特点

### 1. 现代化界面
- 采用简洁现代的设计风格
- 统一的配色方案和视觉元素
- 响应式布局，适应不同屏幕尺寸
- 使用QSS样式美化界面

### 2. 用户体验优化
- 表格行交替颜色，提高可读性
- 按钮颜色区分功能类型（主要、次要、危险等）
- 表单字段布局合理，操作流程清晰
- 添加提示信息，引导用户操作
- 拖放功能支持，简化文件操作

### 3. 视觉元素
- 标题和分组清晰，层次分明
- 重要信息突出显示
- 表格样式统一，便于信息浏览
- 按钮样式美观，交互反馈明确
- 状态变化视觉反馈，操作过程清晰可见

### 4. 性能优化
- 支持高DPI显示
- 优化表格渲染性能
- 减少不必要的UI刷新
- 异步处理耗时操作，保持界面响应

## 安装说明

1. 确保已安装Python 3.6或更高版本
2. 克隆或下载本项目
3. 安装依赖包：
   ```bash
   pip install -r requirements.txt
   ```

## 使用说明

### 1. 首次使用
1. 运行程序后，系统会自动引导您配置乙方公司信息
2. 在"系统"菜单中选择"配置乙方公司"可以随时修改公司信息

### 2. 客户管理
1. 切换到"客户管理"标签页
2. 点击"添加客户"按钮添加新客户
3. 在客户列表中双击客户可以编辑信息
4. 选中客户后点击"删除客户"可以删除客户
5. 使用搜索框可以快速查找客户

### 3. 商品管理
1. 切换到"商品管理"标签页
2. 点击"添加商品"按钮添加新商品
3. 在商品列表中双击商品可以编辑信息
4. 选中商品后点击"删除商品"可以删除商品
5. 使用搜索框可以快速查找商品

### 4. 合同生成
1. 切换到"合同生成"标签页
2. 在客户列表中选择客户
3. 在商品列表中选择商品并添加到合同
4. 设置合同信息（编号、日期、付款方式等）
5. 选择乙方公司
6. 选择文档类型（仅合同、仅报价单）
7. 选择是否转换为PDF（默认选中）
8. 选择是否添加印章到PDF（默认选中）
9. 选择是否将PDF转换为图片式PDF（默认选中，提高兼容性）
10. 点击"生成合同"按钮生成合同文件
11. 生成完成后可以点击"打开合同文件夹"按钮查看生成的文件

### 5. Excel转PDF工具
1. 切换到"Excel 转 PDF"标签页
2. 将Excel文件直接拖放到虚线框内，系统会自动开始转换
3. 可以选择是否将PDF转换为图片式PDF（默认选中）
4. 转换过程中会显示进度和状态
5. 转换完成后，可以点击"打开PDF"按钮查看生成的PDF文件
6. 如需转换其他文件，点击"重新选择"按钮清除当前选择

### 6. 乙方公司管理
1. 在"系统"菜单中选择"配置乙方公司"
2. 在对话框中可以：
   - 查看所有乙方公司列表
   - 添加新的乙方公司
   - 编辑现有公司信息
   - 删除公司
   - 设置默认公司
   - 从文本解析导入公司信息

## 文件说明

- `src/`: 源代码目录
  - `ui/`: 用户界面相关代码
    - `option_tab.py`: Excel转PDF功能实现
  - `models/`: 数据模型相关代码
  - `utils/`: 工具类代码
    - `excel_to_pdf.py`: Excel转PDF转换工具
  - `resources/`: 资源文件（图标等）
- `data/`: 数据文件目录
  - `customers.xlsx`: 客户数据
  - `products.xlsx`: 商品数据
- `output/`: 输出文件目录
  - `contracts/`: 生成的合同文件
- `templates/`: 模板文件目录
  - `contract_template.xlsx`: 合同模板
  - `quote_template.xlsx`: 报价单模板
- `config/`: 配置文件目录
  - `company.json`: 公司信息配置
  - `settings.ini`: 系统设置配置
- `resources/`: 资源文件目录
  - `icon.ico`: 应用程序图标

## 配置说明

### 配置文件位置
程序的配置文件存储在项目根目录的 `config` 目录下：
1. `config/company.json`: 存储公司信息，包括公司名称、联系人、地址等
2. `config/settings.ini`: 存储系统设置，如模板路径、输出目录等

首次运行程序时，这些配置文件会自动创建并填充默认值。您可以通过程序界面或直接编辑这些文件来修改配置。

### 配置文件说明

#### company.json
存储公司信息的JSON文件，包含以下字段：
- `name`: 公司名称
- `contact`: 联系人
- `phone`: 联系电话
- `address`: 公司地址
- `bank_name`: 开户银行
- `bank_account`: 银行账号
- `tax_id`: 税号
- `is_default`: 是否为默认公司

#### settings.ini
系统设置配置文件，包含以下主要设置：
- `[General]`
  - `contract_template`: 合同模板路径
  - `quote_template`: 报价单模板路径
  - `output_dir`: 输出目录路径

## 注意事项

1. 首次使用前请确保已正确配置乙方公司信息
2. 生成合同前请确保已选择客户和添加商品
3. 合同编号格式为：SC-YYYYMMDD-XXX
4. 技术服务费为商品总金额的10%，且不小于1500元
5. 所有金额计算保留两位小数
6. Excel转PDF功能支持的Excel文件格式为.xlsx

## 版本历史

### v1.1.0 (2024-03-15)
- 新增功能：
  - 添加了Excel转PDF工具，支持拖放转换
  - 添加了图片式PDF选项，提高PDF兼容性
  - 优化了用户界面，添加了状态反馈和进度显示
  - 新增了公司管理功能，支持添加、编辑、删除和设置默认公司
  - 新增了图标系统，使用自定义图标美化界面
  - 优化了印章添加功能，支持在报价单上显示"报价方签章处"文字
- 改进：
  - 优化了界面布局和交互体验
  - 改进了文件命名规则，添加随机后缀避免重名
  - 完善了错误处理和提示信息
  - 添加了拖放功能，简化文件操作
- 修复：
  - 修复了印章添加时的文字对齐问题
  - 修复了文件生成时的随机后缀缺失问题

### v1.0.0 (2024-03-12)
- 初始版本发布
- 基础功能：
  - 合同管理
  - 报价单生成
  - 印章添加
  - 数据导出

## 开发计划

1. 添加合同模板自定义功能
2. 添加合同历史记录管理
3. 支持数据备份和恢复
4. 添加用户权限管理
5. 优化性能和用户体验
6. 添加批量转换Excel文件功能

## 贡献指南

欢迎提交Issue和Pull Request来帮助改进这个项目。

## 许可证

本项目采用 MIT 许可证。

## 打包说明

### 使用PyInstaller打包
1. 确保已安装Python 3.6或更高版本
2. 双击运行`build_with_spec.bat`，脚本会自动：
   - 安装/更新所需依赖包（包括PyInstaller）
   - 清理旧的构建文件
   - 使用PyInstaller打包程序为可执行文件
   - 创建必要的目录结构
   - 复制必要的资源文件
3. 打包完成后，可执行文件位于`dist/contractG`目录

### 开发环境打包
1. 确保已安装Python 3.6或更高版本
2. 双击运行`build.bat`，脚本会自动：
   - 安装/更新所需依赖包
   - 清理旧的构建文件
   - 打包程序为可执行文件
   - 复制必要的资源文件
3. 打包完成后，可执行文件位于`dist/contractG`目录

### 安装程序
1. 运行打包后生成的安装脚本`install.bat`
2. 安装程序会自动：
   - 将程序安装到Program Files目录
   - 创建必要的数据目录
   - 创建桌面快捷方式
   - 创建开始菜单快捷方式

### 注意事项
1. 打包过程需要管理员权限
2. 如果遇到杀毒软件报警，请将程序添加到白名单
3. 建议将程序安装在非系统盘，并关闭杀毒软件对程序目录的实时监控
4. 首次运行时请确保已正确配置公司信息
5. 使用PyInstaller打包时，可能需要手动安装UPX来减小生成的可执行文件大小

